

30.10.2017
~~~~~~~~~~~~~~~~~~~

На проводе ком порта, основное питание - батарея
Проверил - качество связи не падает в полете (в т.ч. осциллом наводки не увелич.) - около 100 Гц
Есть смещение по тангажу в qground. Контроллер на коптере стоит ровно.

1) Сначала ручное, с середины по времени - регулятор
M1 = 0.42
        norm_coef = 1. * 0.45 / (M1 * G)
        # thrust = norm_coef * (M1 * sqrt(Azz * Azz))
        thrust = norm_coef * (M1 * sqrt(Azz * Azz + Axx * Axx))
        pitch = 10.0 * atan(Axx / Azz)
        roll = -10.0 * atan(Ayy / Azz)
        
1509362169.77_regulation

Период колебаний - около 5 сек., 0.2 Гц

2) Убрал регулирование по roll, регулятор включил почти сразу.

1509363044.55_regulation

Период колебаний - около 5 сек., 0.2 Гц


31.10.2017
~~~~~~~~~~~~~~~~~~~

1) Регулятор по 
        pitch = 10.0 * atan(Axx / Azz)
        roll = -10.0 * atan(Ayy / Azz)
Поднял чушку и провод на стул - дабы масса в полете не менялась

1509418553.74_regulation

Все так же - колебания с периодом 5 сек.

2) Все так же + сделал LPE_GPS_DELAY 0 сек вместо 0.29

1509421070.55_regulation

Колебания усилились (возможно батарея разряжена) но смещения по x, y почти нет !

3) Еще проверка на свежей батарее

1509422053.68_regulation

Смещения нет, но колебания остались

4) Вернул LPE_GPS_DELAY 0.29

1509422650.1_regulation

Смещения все равно нет ???


1.11.2017
~~~~~~~~~~~~~~~~~~
1) Занулили pitch и roll
Колебания остались

1509520160.97_regulation

2)В QGround откалибровали тангаж, по идее должен перестать смещаться в сторону  окна

02.11.2017
~~~~~~~~~~~~~~~~~~


1) LPE_VIZ_Z уменьшил с 0.05 до 0.01

1509602263.33_regulation

батарея разрядилась - высота меньше

2) Свежая батарея

1509602942.41_regulation

Высота норм. Остались колебания

03.11.2017
~~~~~~~~~~~~~~~~~~

LPE_VIZ_Z так же 0.01

Сделал

RC_FLT_CUTOFF 40 вместо 10
RC_FLT_SMP_RATE 100 вместо 50

1) 1509683455.34_regulation

Высота на уровне 0.3 Батарея ? Показывала до взлета 11.7 В

2) 1509683814.3_regulation

Поменял батарею. Высота на уровне 0.8 Показывала до взлета 12.27 В

Колебаниям пелевать на все.


Новый алгоритм с компенсацией транспортной задержки

3)Свежая батарея
        n_delay = 40
        self.z_ref = 0.8
1509708099.01_regulation

4)        self.z_ref = 1.3
1509708334.21_regulation

5)Свежая батарея        self.z_ref = 1.3
1509708652.14_regulation

Всегда - линейное спадение высоты. Колебания остались ?
Не держат батареи ?

6) Алгоритм без комп. запаздывания, с регул. по roll, pitch.
1509709052.03_regulation

Линейное падение высоты есть - но вроде меньше.


07.11.2017
~~~~~~~~~~~~~~~~~~

Новый алгоритм с компенсацией транспортной задержки

1)
        n_delay = 100
        self.z_ref = 0.8
1510028116.61_regulation

2)
        n_delay = 70
        self.z_ref = 0.8
1510028654.0_regulation

3)
        n_delay = 70
        self.z_ref = 1.5
1510028731.4_regulation

4)
Свежая батарея1
        n_delay = 70
        self.z_ref = 0.8
1510029899.4_regulation

5)
Свежая батарея2 - 2й запуск
        n_delay = 85
        self.z_ref = 1.5
1510030895.91_regulation

6) Алгоритм без комп. запаздывания, с регул. по roll, pitch.
Свежая батарея
        self.z_ref = 0.8
1510035379.51_regulation

7) Алгоритм без комп. запаздывания, с регул. по roll, pitch.
Свежая батарея
        self.z_ref = 0.8
1510037764.9_regulation

Отставание тяги от высоты - мировая константа 1.5 сек (в предыдущих экспер-х с этим же регулятором так же) !!!


8)Попробовали изменить коэффициент k_z 
при k_z = 3. сходит с ума, появляются колебания по z большой амплитуды

1510297372.49_regulation




